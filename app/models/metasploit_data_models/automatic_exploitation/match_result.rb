class MetasploitDataModels::AutomaticExploitation::MatchResult < ActiveRecord::Base

  # Running associated exploit did NOT create a session
  FAILED = "failed"
  # Running associated exploit created a session
  SUCCEEDED = "succeeded"

  VALID_STATES = [FAILED, SUCCEEDED]

  #
  # ASSOCIATIONS
  #

  belongs_to :match,
             class_name: 'MetasploitDataModels::AutomaticExploitation::Match',
             inverse_of: :match_results,
             dependent: :destroy

  belongs_to :run,
             inverse_of: :match_results,
             class_name: 'MetasploitDataModels::AutomaticExploitation::Run'

  #
  # VALIDATIONS
  #

  # must be present and one of allowable values
  validates :state,
            presence: true,
            inclusion: VALID_STATES

  #
  # SCOPES
  #
  scope :succeeded, lambda { where(state:"succeeded") }
  scope :failed, lambda { where(state:"failed") }

  Metasploit::Concern.run(self)
end
