class MetasploitDataModels::AutomaticExploitation::Run < ActiveRecord::Base
  attr_accessible :user_id, :workspace_id, :match_set_id

  #
  # ASSOCIATIONS
  #
  belongs_to :user, class_name: "Mdm::User"
  belongs_to :workspace, class_name: "Mdm::Workspace"

  has_many :match_results, class_name:'::MetasploitDataModels::AutomaticExploitation::MatchResult'

  state_machine :state, initial: :not_yet_started do
    event :start do
      transition [:not_yet_started] => :running
    end

    event :finish do
      transition [:running] => :finished
    end

    event :error_out do
      transition [:running] => :failed
    end
  end

  Metasploit::Concern.run(self)
end